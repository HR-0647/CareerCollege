# 2017年 前期 期末試験

試験の回答は、以下の通りにすること。

- １問あたり１ファイルに記述。ファイル名は「1-1.txt」でも「問1-1.txt」でも可。フォーマットはtext、拡張子は.txtとする
- 文字コードはUTF-8のすること

試験の注意事項は以下の通り

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨

提出は、以下の通り

- 授業内に提出する場合は、ファイルサーバ内の所定のフォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は1/19)

## 基本的なPHPの文法: 10問各２点

### (問1-1)変数への値の代入

変数名「val」に、文字列「123」を代入せよ

### (問1-2)四則演算

(1 + 2) * 3 の四則演算をし、その結果を変数「i」に代入せよ

### (問1-3)文字列の連結

文字列「abc」と文字列「123」を文字列連結し、その結果を変数「s」に代入せよ

### (問1-4)基本的なif文

変数「i」に「問1-2」の結果を代入せよ。    
次に、「もし変数 iの値が9と等しい」ようであれば、標準出力(echo等で出力)に「ok」と出力せよ

### (問1-5)elseのあるif文

変数「i」に、乱数で「10～30」の値を代入せよ( 乱数は mt_rand(10, 30)で作成が出来る )。    
次に、もし変数 iが20未満なら、標準出力に「未成年」と出力し、それ以外なら「成人」と出力せよ

### (問1-6)for文を使ったループ

0から99までの数字を、for文を使って出力せよ    

### (問1-7)配列の作成

要素として「abc」「def」「ghi」の３つを持つ配列を作成せよ    
なお、PHPのバージョンは7.1とする

### (問1-8)foreachによるループ

問1-7で作った配列の内容を、foreachを使ってすべて出力せよ

### (問1-9)簡単な関数の作成

引数が２つあり、戻り値が「二つの引数を(数値であると仮定して)加算(足し算)してreturnする」関数を書け    
関数名は任意とする

### (問1-10)簡単なclassの作成

以下の要件を満たすclassを書け    
クラス名は任意とする

- コンストラクタを書け。内容は空でよい
- プロパティ「price」を、privateで作成せよ
- 上述プロパティにデータを入れるための「setPrice」メソッドを作成せよ
- メソッド「getPriceWithTax」を作成せよ。処理内容は「プロパティ price に消費税8%を加算したもの(小数点以下切り捨て)をreturnする」とする

## (問2)破壊型の関数：20点

「引数の値を変更する」、いわゆる破壊型の関数(PHPマニュアルの用語としては"引数の参照渡し")を作成せよ    
処理内容は以下の通りとする

- 引数が「配列であること」を確認せよ。配列である事の確認には is_array() 関数が使える
- 引数で渡された配列の最後に、文字列「end」を追加する

## (問4)filter_varをつかったvalidate：20点

filter_var()関数(の検証フィルタ)をつかって「emailアドレス」「小数(float)」の検証をするコードを書け    
filter_var()関数の仕様については、Google等を使って調べながら行う事。閲覧するサイトは、PHPの公式マニュアルであること( http://php.net/manual/ja/ )が望ましい

## マジックメソッド

以下のマジックメソッドをもつクラスを書け    
特に指定のないクラス名、メソッド名、プロパティ名は、任意とする

### (問5-1)：10点

以下の仕様を満たすクラスを書け

- コンストラクタで「引数のファイル名でファイルハンドルをopen：openできなかったら例外を投げる」
    + ファイルハンドル及びファイル名は、適切なプロパティに保存せよ
- デストラクタで「ファイルclose」

### (問5-2)：10点

問5-1で作ったクラスに追記をして、以下の仕様を満たすクラスを書け

- serialize時に「ファイルハンドルだけ保存しない」ようにせよ
- unserialize時に「ファイルハンドルを改めて接続する」ようにせよ。ファイルがopenできない場合は例外を投げるようにせよ

## (問6)シングルトンを使った「DB接続ハンドル」管理クラスの作成：20点

シングルトンを使った「DB接続ハンドル」の管理クラスを作成せよ。    
クラス名は任意とする

- インスタンスは「getInstance()」で取得できるようにせよ
    + 接続情報は、本来は外部由来のデータを使うが、今回は「メソッドの中に直接値を記述する」でよい。値には、不自然ではない程度に適当な文字列であればよい
- getDbh()メソッドで「クラス内に保存しているPDOクラス」をreturnするようにせよ

## (問7)シングルトンに__callを足したクラス：20点(難問)

問6のクラスに加えて「PDOの各メソッドが直接使える」ように、マジックメソッド「__call」を使って実装せよ    
例題として。問6で「PDOクラスのqueryメソッドを使う」場合は、以下のようになる。

	DB接続管理クラス::getInstance()->getDbh()->query($sql)

これを、以下のように使いたい。

	DB接続管理クラス::getInstance()->query($sql)

