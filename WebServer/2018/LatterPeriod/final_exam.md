# 2019年 後期 期末試験

試験の回答は、以下の通りにすること。

- １問あたり１ファイルに記述。ファイル名は「1-1.txt」でも「問1-1.txt」でも可。フォーマットはtext、拡張子は.txtとする
- 文字コードはUTF-8にすること

試験の注意事項は以下の通り

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も「書いてある点数」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 授業内に提出する場合は、ファイルサーバ内の所定のフォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は1/25)

## 時間関連

文字列 "January 21st, 2019" があります。
```
$date_string = 'January 21st, 2019';
```
この文字列を「YYYY/MM/DD」(YYYYは年、MMは月(数値表記)、DDは日)に変換して表示をしたい、というニーズがあります。

### (問1-1): 5点

この処理を    
・date関数    
を使って記述しなさい。    

### (問1-2): 5点

この処理を    
・DateTimeクラス    
を使って記述しなさい。    

### (問1-3): 5点

この処理を    
・DateTimeImmutableクラス    
を使って記述しなさい。    

## (問2)継承を含むクラス: 10点

以下のクラス定義を書きなさい。    
メソッドの中身(処理)は、空っぽのままでよい、とします。「// 処理」のコメント程度を書いておくとよいでしょう。    
メソッドは指定がない限りpublic、プロパティは指定がない限りprivateにしなさい。    

- Hogeクラス
    + コンストラクタ
    + デストラクタ
    + getDataメソッド: 引数無し
    + setDataメソッド: 引数一つ
    + validateDataメソッド: 引数無し、protected
    + data プロパティ
    + counter プロパティ
- Fooクラス: Hogeクラスを継承すること
    + コンストラクタ：処理の先頭で「親のコンストラクタ」をcallすること
    + デストラクタ：処理の最後で「親のデストラクタ」をcallすること
    + setDataメソッド: 引数一つ
    + pushDataメソッド: 引数一つ
    + popDataメソッド: 引数無し

## マジックメソッド

以下の実装を、PHPのマジックメソッドを使って実装しなさい。    

### (問3-1) __set()/ __get(): 10点

「アクセス不能なプロパティ(存在していないプロパティ / 外部からのpriveteやprotectedなプロパティへのアクセス)」に値を入れる、若しくは値を参照しようとしたときに「エラーメッセージを出力する」コードを実装しなさい。    
エラーメッセージには「どんな名前のプロパティにアクセスしようとしていたか」を含めなさい。    

### (問3-2) __construct() / __destruct(): 10点

「newでインスタンスを作った瞬間」および「インスタンスが破棄される瞬間」に動くメソッドを実装しなさい。    
newされた瞬間のメソッドでは"Create"、破棄される瞬間のメソッドでは"Destroying"の文字列を出力(echo)しなさい。    


### (問3-3) __clone(): 10点

以下の、不完全なコードがあります。    

```
class Hoge {
    public function __construct() {
        $this->foo_obj = new Foo();
    }

private $foo_obj;
}

class Foo {
}

// インスタンスの作成
$hoge_1 = new Hoge();

// インスタンスのclose
$hoge_2 = clone $hoge_1 ;

var_dump($hoge_1, $hoge_2);
```

このコードは、典型的な「シャローコピー(Shallow Copy) / 浅いcopy」の実装です。    
この実装に追加をして、ディープコピー(Deep Copy)ができるコードに書き換えをしなさい。    

## (問4)Singleton: 10点

Singletonパターンの実装を必要としています。    
以下の要件に従って、Singletonクラスを実装しなさい。    

- クラス名は「Singleton」とする
- インスタンスの取得は「getInstance()」メソッドで行うものとする
- 外部から、newおよびcloneができないようにする


## (問5)例外: 10点

前提として以下のコードがあり、関数「exam()」があります。    
この関数はエラーを返す可能性がありますが、それを、戻り値によるエラー告知ではなく、例外によるエラー告知にしたい、というニーズがあります。   

```
function exam() {
    // 処理
    // 処理
}

// 実行(エラー処理 未実装)
exam();
```

上述のコードに、以下の修正を加えなさい。    

- コードの実行(call)部分を try-catch で囲みなさい。投げられる例外は ErrorException クラス１種類とします
- 関数 exam()内で、テスト用にErrorExceptionクラスで例外を投げなさい。メッセージ内容は自由に書いてよい
- 例外をキャッチした時の処理は「投げられたメッセージ内容を出力(echo)する」としなさい

## SPL

### (問6-1)arrayObject: 5点

arrayObjectクラスを使って、配列を作成しなさい。    
配列の中身は、1から10までの整数を１つづつ、とします。   

### (問6-2)SplQueue: 5点

Queue構造を表す、SplQueueクラスをつかって、そのキューに「mt_rand(0, 99)」で得られる乱数を10個、要素として追加しなさい。    
また、積んだ内容をforeachを使って全て出力しなさい。    

### (問6-3)再帰的なディレクトリイテレータ: 5点

「そのファイルの存在するディレクトリ」を、PHPでは \_\_DIR\_\_ 定数で得る事ができます。    
RecursiveDirectoryIteratorクラス、RecursiveIteratorIteratorクラスなどを使って「\_\_DIR\_\_を起点に、再帰的に「\_\_DIR\_\_ 以下にある、全てのファイル名を出力する」コード」を実装しなさい。    


## (問7)JavaScriptでAjax: 10点

REST APIで「UUIDv4を出力する」コードの実装を要求されました。    
APIの仕様は、以下の通りのhash配列です(statusの200は固定です)。

```
status: 200
uuid: (UUIDの文字列)
```

uuidの文字列は、以下の処理で取得できるものとします。    

```
$uuid = trim(shell_exec('uuidgen -r'));

```

hash配列を適切に作成し、jsonにエンコードして適切なheaderにして出力をするコード、を実装しなさい。    

