# 2017年 後期 期末試験

試験の回答は、以下の通りにすること。

- １問あたり１ファイルに記述。ファイル名は「1-1.txt」でも「問1-1.txt」でも可。フォーマットはtext、拡張子は.txtとする
- 文字コードはUTF-8のすること

試験の注意事項は以下の通り

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可(ただし後述の"グループ提出"のグループメンバーとの相談は可)
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も「１問あたり５点」を満点とし、問題があったら適宜減点する

今回の試験は、以下を条件に「グループ提出」を許可する

- ２名もしくは３名でグループを組む事が出来る
- グループで組む場合は「１グループで１つ」答えを提出せよ。また「グループ全員の名前がわかる」ようにせよ
- ２名グループは合計点の90%、３名グループは合計点の80%が、各個人の成績評価用の得点になる

提出は、以下の通り

- 授業内に提出する場合は、ファイルサーバ内の所定のフォルダの中に「名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は1/23)

## 単純なPHPのプログラミング

### (問1-1)：10点

1D12(１～12までの幅の乱数)を１回作成し、変数名 $i に代入せよ。

### (問1-2)：10点

「自分(達)の名前」の文字列のハッシュを作成し、変数 $hash に代入せよ。    
hash関数は、md5、sha1、sha256、sha512のいずれか１つを選べ。

## ガチャテーブルとデータの作成

がちゃを引くために必要なテーブルの作成やデータの作成、データ入力用のSQLの作成などを行え

### (問2-1)カード情報作成：10点

前提となる「カード情報」を、10種類以上、作成せよ。フォーマットはtsv(タブ区切りフォーマット)とする。    
内容には「カードID」「レアリティ(★０～★５(FGO等)や、R,SR,SSR(あちこちのソシャゲ)や、コモン、アンコモン、レア(M:tG)など)」「カード名」「攻撃力」「防御力」「フレーバーテキスト」が含まれること。    
イメージとしては以下のようなフォーマットでの記述が期待される。[TAB]は、Tab文字(\t)を意味する。    

```
1[TAB]コモン[TAB]コボルト[TAB]1[TAB]1[TAB]最弱レベルのモンスター
2[TAB]アンコモン[TAB]コボルトプリースト[TAB]1[TAB]3[TAB]神への祈りによって防御力が増したコボルト
```

### (問2-2)がちゃ用テーブルのテーブルレイアウト：10点

がちゃを引くために必要な、確率情報の入ったテーブルのテーブルレイアウトをSQL文で作成せよ。    
最低でも「がちゃタイプ(仮に、1で日次無料、100で有料)」「排出率」「カードID」のカラムが含まれるはずである。    

### (問2-3)日次無料がちゃの作成：15点

問2-2で作ったテーブルに、「日次無料がちゃ」用のINSERT文を作成せよ。    
使われるカードIDは、問2-1で作った情報であること。

### (問2-4)有料がちゃの作成：15点

問2-2で作ったテーブルに、「有料がちゃ」用のINSERT文を作成せよ。    
使われるカードIDは、問2-1で作った情報であること。


## (問3)上述がちゃテーブルを使ったがちゃの実装：50点

問2で作ったテーブルが存在する前提で、実際に「がちゃを引く」プログラムを作成せよ。    
認証は「行われているもの」と仮定：認証情報はsessionに入っている想定。    

ユーザ所持カードテーブルは、以下のものがすでに存在するものとする。

```
CREATE TABLE user_card (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    user_id BIGINT UNSIGNED,
    card_id INT UNSIGNED,
    PRIMARY KEY (id)
);
```

がちゃのプログラムは、以下のインタフェーで作成すること。    

- リクエスト：gatya=がちゃタイプ('free': 日次無料,  'fee_10':有料10連続)
- レスポンス：jsonフォーマット(中に「引いたカードID」の情報を含める事)

採点ポイントは以下の通りである。    
なお「有料課金がちゃにおけるポイント(課金石等)の消費」は、今回は「コメントに書いておく」程度で、処理としては書かなくてよい。

- がちゃテーブルから「がちゃ一覧」が取得できている: 10点
- 適切に乱数が使われている: 10点
- 有料10連において「カードが10枚」引かれている: 10点
- 引いたカードをINSERTできている: 10点
- jsonで適切に値を返却している: 10点

