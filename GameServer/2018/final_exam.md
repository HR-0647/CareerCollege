# 2018年 前期 期末試験

試験の回答は、以下の通りにすること。

- １問あたり１ファイルに記述。ファイル名は「1-1.txt」でも「問1-1.txt」でも可。フォーマットはtext、拡張子は.txtとする
- 文字コードはUTF-8のすること

試験の注意事項は以下の通り

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も「１問あたり10点」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 授業内に提出する場合は、ファイルサーバ内の所定のフォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は9/3)

## 「特定のゲーム」のPC一人を入れられるテーブルを作成

「１ゲーム内の１プレイキャラクタ」の情報を格納できるCREATE TABLE文を作成しなさい。    
カラム名は、日本語をそのまま使っても、適切な英語名にしてもよい、とします。    
数値については、いずれも「負の値を持たない、65535以下」程度の値を想定しなさい。    


### (問1) ファイナルファンタジーⅢ のキャラクタ作成

ファイナルファンタジーⅢ のプレイキャラクタ一人を格納できるテーブルを作成しなさい。    
名前以外はすべて数値で、所持金と経験値は65535以下、それ以外の数値は255以下の値をとります。    
なお、パラメタは以下の通りとする。    

- 名前
- HP
- 最大HP
- MP
- 最大MP
- 力
- 速
- 体
- 知
- 精
- 所持金
- EXP
- レベル


## 基本的なSQL構文

以下のテーブルに対して、適切なデータを取得できるSQL文を書きなさい。

```
CREATE TABLE exam (
  id int unsigned NOT NULL AUTO_INCREMENT,
  num int,
  name varchar(128),
  created datetime,
  PRIMARY KEY(id)
);
```

### (問2-1)select文：テーブル全部

examテーブルの「全てのレコード」を取得するSQLを書きなさい。

### (問2-2)select文：WHERE句

examテーブルのうち「idが10のレコード」を取得するSQLを書きなさい。

## PHPでのDB接続

### (問3-1)PDOによる接続

PHPで、PDOクラスを使ってdatabaseに接続するプログラムを書きなさい。    
接続情報は以下の通りとする。    

- 接続ID: test
- 接続パスワード: pass
- 接続database: database
- 接続サーバ: 192.168.0.1
- 文字コード: utf8mb4

### (問3-2)PDOによるSQL発行(INSERT)

問2に出てきたテーブルに１レコード追加するPHPプログラムを書きなさい。    
INSERTするデータは任意とする。


## パスワードのハッシュ

### (問4)認証情報の登録

$passに「ユーザから入力されたパスワードが入っている」前提で、パスワードを適切にハッシュ処理しなさい。    
ハッシュの結果、および必要であれば付帯情報を、それぞれわかるようにechoしなさい。    
なお、PHPのバージョンは5.5以降である、とします。    

## 簡単な乱数の作成

### (問5-1)「乱数を取得する関数」の作成

PHPで「１から６までの間の乱数」を作成し、戻り値として返す関数を書きなさい。    
関数名は「dice_6」とします。

### (問5-2)文字列を使った乱数の作成(難問)

以下の文字列が解釈可能なコードを書きなさい。    
なお「計算結果が負の値になる」場合、そのまま負の値をreturnしなさい。

- 2D6+2
- 1d4+2d6+3
- 1D10+2d6-1d4-2

## トランザクション

### (問6)トランザクションを使うSQL文の作成：有料がちゃ

有料課金がちゃを引くために必要なSQLを、トランザクションを使って適切に書きなさい。    
また、カードを引く前に「有料課金の残高が足りているかどうか」をSQLで確認しなさい。    

- user_idは2016とする
- userテーブルの残高(money)を取得：PHPプログラムであればif文等でチェック。今回はSQLのみなのでチェック処理はオミット
- userテーブルのmoneyの値を100、減算
- user_cardテーブルにinsert。引いたカードID(card_id)は114とする

```
CREATE TABLE user (
  user_id int unsigned NOT NULL,
  money int unsigned ,
  PRIMARY KEY(user_id)
);
```

```
CREATE TABLE user_card (
  user_card_id int unsigned NOT NULL AUTO_INCREMENT,
  user_id int unsigned NOT NULL,
  card_id int unsigned NOT NULL,
  created datetime,
  PRIMARY KEY(user_card_id)
);
```

## アイテム使用

前提となるPCクラスは以下とする。    
なお、setterとgetterは省略しているが、記述されているものとする(メソッド名はスネーク(get_hp())でもキャメル(getHp())でもどちらでもよい)。    

```
class PC {
// 各プロパティへのsetterとgetter(省略

//private:
private $max_hp_;
private $max_mp_;
private $hp_;
private $mp_;
private $exp_; // 経験値
};
```

### (問7)プログラム型のアイテム使用(難問)

以下の5種類のアイテムを「プログラム型」で実装せよ。    
なお、実装する関数は以下の関数名、引数を取るものとする。「入力値のエラー」は考慮しなくてよい。    

```
function item_use($PCインスタンス, $アイテムID);
```

- HPを100点回復するアイテム(アイテムID: 1)
- MPを50点回復するアイテム(アイテムID: 2)
- HPを50%回復するアイテム(アイテムID: 3)
- HPを50%, MPを50%回復するアイテム(アイテムID: 4)
- 経験値が+1000されるアイテム(アイテムID: 5)



## ゲームの感想

### (問8)ゲームの感想

授業でやったボードゲーム「メディチ」「ドミニオン」「ディプロマシー」から１つ選び、感想を書きなさい。    
或いは、最近やっているゲームから１つ選び、それを勧める文章を書きなさい。    
