# 2019年 後期 期末試験

試験の回答は、以下の通りにすること。

- １問あたり１ファイルに記述。ファイル名は「1-1.txt」でも「問1-1.txt」でも可。フォーマットはtext、拡張子は.txtとする
- 文字コードはUTF-8にすること

試験の注意事項は以下の通り

- 試験なので「周囲との相談」「他人の答案の覗き見」は不許可
- ネット等を使って調べるのは許可
- コードやSQLを勉強用サーバ(dev2.m-fr.net)で確認するのは推奨
- いずれの問題も「書いてある点数」を満点とし、問題があったら適宜減点する

提出は、以下の通り

- 授業内に提出する場合は、ファイルサーバ内の所定のフォルダの中に「自分の名前のフォルダ」を作成して、そこに回答ファイル一式を提出
- 授業外で提出する場合は「自分の名前のフォルダ」に回答ファイル一式を入れた状態でzip形式で固めて教務経由で提出(提出期限は1/22)

## (問1) SQL基礎(テーブル作ってINSERTしてSELECT)

「カード」を使うゲームを作成します。    
一端、カードテーブルは、以下のように設計しました。    
```
カードテーブル
・カードID(数値のPrimary key)
・カード名(全角で16文字以内)
・カードコスト(1～10)
・攻撃力(0～100)
・防御力(0～100)
・フレーバーテキスト(全角で200文字以内)
```

### (問1-1)CREATE TABLE:10点

上述テーブルを作る為の、CREATE TABLE文を作成しなさい。    
RDBMSは、MySQL(MariaDB)とします。    

### (問1-2)INSERT:10点

問1-1で作ったテーブルに、データを入れるためのINSERT文を2つ以上作成しなさい。    
必要なデータは、各人の高い妄想力に期待します。    

## (問2)シングルトンでDBハンドル取得: 20点

```
$dbh = DB::getHandle();
```
で、PDO(DBハンドル)が取得できるクラスを作成しなさい。    
そのクラスは「シングルトン」であり、プログラムのどこで上述をcallしても「同じDBハンドルが取得できる」ようにすること。    
DB接続のための情報は、DBクラスに直接、べた書きでOKとする。    


## (問3)クラス基礎: 20点

問1で作ったテーブルを使うクラスを作成しなさい。    
そのクラスには、以下の機能があること。    

・コンストラクタでカードIDを渡すと、クラスの中に「指定されたカードID」の情報が入ること
・カード情報は「DBの中」の情報を、SELECT文で取得すること：DBハンドルは、問2で作成したクラスを使う事    
・カード名、カード超すと、攻撃力、防御力、フレーバーテキストを、マジックメソッド __get を使ってアクセス可能にすること    

サンプルとして、以下のようなコードが動くこと(クラス名は以下の通りでなくてもよい)。
```
$card_obj = new Card($card_id);

echo "カード名は" , $card_obj->card_name , "です\n";
```

## (問4)がちゃロジック: 20点

あらかじめ、以下の情報がある、と仮定します。
```
// card_id => 確率
$gatya_list = [
    1 => 50,
    2 => 30,
    3 => 15,
    4 => 5,
];

```

このとき

```
$card_id = gatya($gatya_list);

```
で、「確率を考慮した」がちゃが引ける「function gatya($gatya_list)」を実装しなさい。    


## (問5)高難度: 20点

とあるゲームを実装しています。    
そのゲームのゲーム内ショップは    

- かなり大量の商品を扱っている
- ただし「ある一瞬」に取り扱ってる商品数はそんなに多くない
- 「取り扱ってる商品」は、8時間毎(0時、8時、16時)に入れ替わる
- 「取り扱ってる商品」は、全てのユーザで一緒

という仕様です。    
上述仕様に基づいて    

- 「取扱商品全部」を格納するテーブル
- 「現在の取扱商品」を格納するテーブル(過去情報は、入っていても入っていなくてもよい)
- 「現在の取扱商品」を入れ替えるためのプログラム
- 現在の取扱商品を入れ替えるためのプログラム」を8時間毎に動かすための方法

を設計し、作成しなさい。   
なお、商品テーブル自体は、一端「商品ID( item_id )、商品名( item_name )を含むテーブルである」という程度の仮定で進めます。    
